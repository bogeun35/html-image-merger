<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì´ë¯¸ì§€ ë³‘í•©</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:sans-serif;background:#f5f5f5;padding:10px}
.container{display:grid;grid-template-columns:200px 1fr 1fr;gap:10px;height:calc(100vh - 20px)}
.box{background:#fff;border-radius:8px;padding:15px;overflow:auto;box-shadow:0 2px 4px rgba(0,0,0,.1)}
.box-title{font-size:16px;font-weight:600;color:#333;margin-bottom:10px;padding-bottom:8px;border-bottom:2px solid #667eea}
textarea{width:100%;min-height:80px;max-height:200px;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:11px;font-family:monospace;resize:vertical}
textarea:focus{outline:none;border-color:#667eea}
button{padding:8px 16px;border:none;border-radius:4px;font-size:13px;font-weight:600;cursor:pointer;margin-top:8px;margin-right:5px}
.btn-primary{background:#667eea;color:#fff}
.btn-primary:hover{background:#5568d3}
.btn-secondary{background:#e0e0e0;color:#333}
.btn-secondary:hover{background:#d0d0d0}
.status{padding:8px;border-radius:4px;font-size:11px;margin-top:8px;display:none}
.status-info{background:#e3f2fd;color:#1976d2}
.status-success{background:#e8f5e9;color:#388e3c}
.status-error{background:#ffebee;color:#d32f2f}
.hint{font-size:11px;color:#666;margin-top:5px;line-height:1.4}
.section{margin-bottom:20px}
.section-title{font-size:14px;font-weight:600;color:#333;margin-bottom:8px}
.copied-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px;margin-top:10px;max-height:300px;overflow:auto;padding:5px;border:2px dashed #ddd;border-radius:4px;min-height:150px}
.copied-grid.drag-over{border-color:#667eea;background:#f0f4ff}
.copied-item{position:relative;border:2px solid #28a745;border-radius:4px;padding:5px;background:#f0f9f4;cursor:move}
.copied-item.dragging{opacity:.5}
.copied-item.drag-over-item{border-color:#667eea;border-style:dashed}
.copied-item img{width:100%;height:80px;object-fit:contain;display:block;pointer-events:none}
.remove-btn{position:absolute;top:2px;right:2px;width:20px;height:20px;background:rgba(255,0,0,.8);color:#fff;border:none;border-radius:50%;font-size:12px;cursor:pointer;line-height:20px;padding:0;z-index:10}
.remove-btn:hover{background:rgba(255,0,0,1)}
.extracted-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px;margin-top:10px;max-height:350px;overflow:auto}
.extracted-item{border:2px solid #ddd;border-radius:4px;padding:5px;background:#f9f9f9}
.extracted-item img{width:100%;height:120px;object-fit:contain;display:block}
#result{text-align:center;max-height:calc(100% - 60px);overflow:auto}
#result img{max-width:100%;border-radius:4px;margin-top:10px}
.drop-hint{text-align:center;color:#999;padding:40px 10px;font-size:12px}
</style>
</head>
<body>
<div class="container">
<!-- ì¢Œ: HTML ì…ë ¥ -->
<div class="box">
<div class="box-title">HTML ì…ë ¥</div>
<textarea id="htmlInput" placeholder="HTML ë¶™ì—¬ë„£ê¸°"></textarea>
<button class="btn-primary" onclick="extractImages()">ğŸ” ì¶”ì¶œ</button>
<button class="btn-secondary" onclick="clearInput()">ì´ˆê¸°í™”</button>
<div class="status" id="status1"></div>
</div>

<!-- ì¤‘: ì¶”ì¶œ & ë³‘í•© -->
<div class="box">
<div class="section">
<div class="section-title">1. ì¶”ì¶œëœ ì´ë¯¸ì§€ (<span id="extractCount">0</span>ê°œ)</div>
<div class="hint">ğŸ’¡ ì´ë¯¸ì§€ì—ì„œ ìš°í´ë¦­ â†’ "ì´ë¯¸ì§€ ë³µì‚¬" â†’ ì•„ë˜ì— ë¶™ì—¬ë„£ê¸°</div>
<div class="extracted-grid" id="extractedGrid"></div>
</div>

<div class="section">
<div class="section-title">2. ë³‘í•©í•  ì´ë¯¸ì§€ (<span id="copyCount">0</span>ê°œ)</div>
<div class="hint">ğŸ“‹ Ctrl+V ë¶™ì—¬ë„£ê¸° | íŒŒì¼ ë“œë˜ê·¸ì•¤ë“œë¡­ | ë“œë˜ê·¸ë¡œ ìˆœì„œ ë³€ê²½ | Xë¡œ ì‚­ì œ</div>
<div class="copied-grid" id="copiedGrid">
<div class="drop-hint">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸ì•¤ë“œë¡­ í•˜ê±°ë‚˜<br>Ctrl+Vë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”</div>
</div>
<button class="btn-primary" onclick="mergeImages()">ğŸ”„ ë³‘í•©í•˜ê¸°</button>
<button class="btn-secondary" onclick="clearCopied()">ì „ì²´ì‚­ì œ</button>
<div class="status" id="status2"></div>
</div>
</div>

<!-- ìš°: ê²°ê³¼ -->
<div class="box">
<div class="box-title">ë³‘í•© ê²°ê³¼</div>
<div id="result"></div>
</div>
</div>

<script>
let urls=[];
let copiedImages=[];
let draggedIndex=null;

// í˜ì´ì§€ ë¡œë“œ
document.addEventListener('DOMContentLoaded',()=>{
const copiedGrid=document.getElementById('copiedGrid');
// ë¶™ì—¬ë„£ê¸°
document.addEventListener('paste',handlePaste);
// ë“œë˜ê·¸ì•¤ë“œë¡­ (íŒŒì¼)
copiedGrid.addEventListener('dragover',e=>{
if(e.dataTransfer.types.includes('Files')){
e.preventDefault();
copiedGrid.classList.add('drag-over');
}
});
copiedGrid.addEventListener('dragleave',()=>copiedGrid.classList.remove('drag-over'));
copiedGrid.addEventListener('drop',handleDrop);
});

function handlePaste(e){
const items=e.clipboardData?.items;
if(!items)return;
for(let item of items){
if(item.type.indexOf('image')!==-1){
const file=item.getAsFile();
addCopiedImage(file);
e.preventDefault();
}
}
}

function handleDrop(e){
e.preventDefault();
const copiedGrid=document.getElementById('copiedGrid');
copiedGrid.classList.remove('drag-over');
const files=Array.from(e.dataTransfer.files).filter(f=>f.type.startsWith('image/'));
if(files.length>0){
files.forEach(file=>addCopiedImage(file));
showStatus('status2',`${files.length}ê°œ ì´ë¯¸ì§€ ì¶”ê°€ë¨`,'success');
}
}

function decodeNaverUrl(url){
try{
if(url.includes('dthumb-phinf.pstatic.net')||url.includes('phinf.pstatic.net')){
const srcMatch=url.match(/[?&]src=([^&]+)/);
if(srcMatch){
let innerUrl=decodeURIComponent(srcMatch[1]);
innerUrl=innerUrl.replace(/^["']|["']$/g,'');
return decodeNaverUrl(innerUrl);
}
}
return url;
}catch(e){return url}
}

function extractImages(){
const html=document.getElementById('htmlInput').value.trim();
if(!html){showStatus('status1','HTMLì„ ì…ë ¥í•˜ì„¸ìš”','error');return}
try{
const doc=new DOMParser().parseFromString(html,'text/html');
const imgs=doc.querySelectorAll('img');
urls=[];
imgs.forEach(img=>{
let src=img.getAttribute('src');
if(src&&src.trim()){
src=decodeNaverUrl(src.trim());
urls.push(src);
}
});
if(!urls.length){showStatus('status1','ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤','error');return}
const grid=document.getElementById('extractedGrid');
grid.innerHTML='';
urls.forEach((url,i)=>{
const div=document.createElement('div');
div.className='extracted-item';
div.innerHTML=`<img src="${url}" onerror="this.style.display='none'">`;
grid.appendChild(div);
});
document.getElementById('extractCount').textContent=urls.length;
showStatus('status1',`${urls.length}ê°œ ì¶”ì¶œ ì™„ë£Œ`,'success');
}catch(e){showStatus('status1',`ì˜¤ë¥˜: ${e.message}`,'error')}
}

function addCopiedImage(file){
const reader=new FileReader();
reader.onload=e=>{
copiedImages.push({file,dataUrl:e.target.result});
updateCopiedGrid();
};
reader.readAsDataURL(file);
}

function updateCopiedGrid(){
const grid=document.getElementById('copiedGrid');
if(copiedImages.length===0){
grid.innerHTML='<div class="drop-hint">ì´ë¯¸ì§€ë¥¼ ë“œë˜ê·¸ì•¤ë“œë¡­ í•˜ê±°ë‚˜<br>Ctrl+Vë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”</div>';
}else{
grid.innerHTML='';
copiedImages.forEach((item,i)=>{
const div=document.createElement('div');
div.className='copied-item';
div.draggable=true;
div.dataset.index=i;
div.innerHTML=`<img src="${item.dataUrl}"><button class="remove-btn" onclick="event.stopPropagation();removeCopied(${i})">Ã—</button>`;
// ë“œë˜ê·¸ ì‹œì‘
div.addEventListener('dragstart',e=>{
draggedIndex=i;
div.classList.add('dragging');
e.dataTransfer.effectAllowed='move';
});
// ë“œë˜ê·¸ ì¢…ë£Œ
div.addEventListener('dragend',()=>{
div.classList.remove('dragging');
document.querySelectorAll('.copied-item').forEach(item=>item.classList.remove('drag-over-item'));
});
// ë“œë˜ê·¸ ì˜¤ë²„
div.addEventListener('dragover',e=>{
if(draggedIndex!==null&&draggedIndex!==i){
e.preventDefault();
div.classList.add('drag-over-item');
}
});
// ë“œë˜ê·¸ ë¦¬ë¸Œ
div.addEventListener('dragleave',()=>{
div.classList.remove('drag-over-item');
});
// ë“œë¡­
div.addEventListener('drop',e=>{
e.preventDefault();
div.classList.remove('drag-over-item');
if(draggedIndex!==null&&draggedIndex!==i){
// ìˆœì„œ ë³€ê²½
const draggedItem=copiedImages[draggedIndex];
copiedImages.splice(draggedIndex,1);
copiedImages.splice(i,0,draggedItem);
draggedIndex=null;
updateCopiedGrid();
}
});
grid.appendChild(div);
});
}
document.getElementById('copyCount').textContent=copiedImages.length;
}

function removeCopied(i){
copiedImages.splice(i,1);
updateCopiedGrid();
}

function clearCopied(){
copiedImages=[];
updateCopiedGrid();
showStatus('status2','ì „ì²´ ì‚­ì œ','info');
}

async function mergeImages(){
if(copiedImages.length===0){showStatus('status2','ë³‘í•©í•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤','error');return}
showStatus('status2','ë³‘í•© ì¤‘...','info');
try{
const imgs=[];
for(let item of copiedImages){
const img=await loadImage(item.dataUrl);
imgs.push(img);
}
const canvas=document.createElement('canvas');
const ctx=canvas.getContext('2d');
const maxW=Math.max(...imgs.map(img=>img.width));
const totalH=imgs.reduce((sum,img)=>sum+img.height,0);
canvas.width=maxW;
canvas.height=totalH;
ctx.fillStyle='white';
ctx.fillRect(0,0,maxW,totalH);
let y=0;
for(const img of imgs){
const x=(maxW-img.width)/2;
ctx.drawImage(img,x,y);
y+=img.height;
}
const dataUrl=canvas.toDataURL('image/jpeg',.95);
document.getElementById('result').innerHTML=`
<p style="color:#28a745;font-weight:600;font-size:14px">âœ… ë³‘í•© ì™„ë£Œ!</p>
<p style="color:#666;font-size:12px;margin-bottom:10px">${maxW} x ${totalH}px</p>
<div style="margin-bottom:15px">
<button class="btn-primary" onclick="downloadImage('${dataUrl}')">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
<button class="btn-primary" onclick="uploadToGitHub('${dataUrl}')">ğŸ“¤ GitHub ì—…ë¡œë“œ</button>
</div>
<img src="${dataUrl}">
`;
showStatus('status2','ë³‘í•© ì™„ë£Œ!','success');
}catch(e){
showStatus('status2',`ì˜¤ë¥˜: ${e.message}`,'error');
}
}

function loadImage(url){
return new Promise((resolve,reject)=>{
const img=new Image();
img.onload=()=>resolve(img);
img.onerror=reject;
img.src=url;
});
}

function downloadImage(dataUrl){
const a=document.createElement('a');
a.download=`merged_${Date.now()}.jpg`;
a.href=dataUrl;
a.click();
}

async function uploadToGitHub(dataUrl){
const GITHUB_TOKEN='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';
const REPO_OWNER='bogeun35';
const REPO_NAME='uploaded-images';

showStatus('status2','GitHub ì—…ë¡œë“œ ì¤‘...','info');

try{
// Base64 ë°ì´í„° ì¶”ì¶œ
const base64Data=dataUrl.split(',')[1];

// íŒŒì¼ëª… ìƒì„± (ë‚ ì§œë³„ í´ë”)
const now=new Date();
const year=now.getFullYear();
const month=String(now.getMonth()+1).padStart(2,'0');
const day=String(now.getDate()).padStart(2,'0');
const timestamp=now.getTime();
const fileName=`merged_${timestamp}.jpg`;
const filePath=`images/${year}/${month}/${day}/${fileName}`;

// GitHub APIë¡œ ì—…ë¡œë“œ
const response=await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${filePath}`,{
method:'PUT',
headers:{
'Authorization':`token ${GITHUB_TOKEN}`,
'Content-Type':'application/json',
},
body:JSON.stringify({
message:`Upload merged image ${fileName}`,
content:base64Data
})
});

if(!response.ok){
const error=await response.json();
throw new Error(error.message||'ì—…ë¡œë“œ ì‹¤íŒ¨');
}

const result=await response.json();
const imageUrl=`https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${filePath}`;

// URLì„ ìƒë‹¨ì— í‘œì‹œ
const resultDiv=document.getElementById('result');
const urlBox=`
<div style="margin-bottom:20px;padding:15px;background:#e8f5e9;border-radius:8px;text-align:left">
<p style="color:#2e7d32;font-weight:600;margin-bottom:10px">âœ… GitHub ì—…ë¡œë“œ ì™„ë£Œ!</p>
<p style="font-size:12px;color:#666;margin-bottom:5px">URL:</p>
<input type="text" value="${imageUrl}" readonly style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:11px;font-family:monospace" onclick="this.select()">
<button class="btn-secondary" style="margin-top:8px;width:100%" onclick="copyToClipboard('${imageUrl}')">ğŸ“‹ URL ë³µì‚¬</button>
</div>
`;
// ê¸°ì¡´ ë‚´ìš© ì•ì— URL ë°•ìŠ¤ ì¶”ê°€
resultDiv.innerHTML=urlBox+resultDiv.innerHTML;

showStatus('status2','âœ… GitHub ì—…ë¡œë“œ ì™„ë£Œ!','success');
}catch(e){
showStatus('status2',`âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ${e.message}`,'error');
console.error(e);
}
}

function copyToClipboard(text){
navigator.clipboard.writeText(text).then(()=>{
showStatus('status2','âœ… URL ë³µì‚¬ ì™„ë£Œ!','success');
}).catch(()=>{
showStatus('status2','âŒ ë³µì‚¬ ì‹¤íŒ¨','error');
});
}

function showStatus(id,msg,type){
const s=document.getElementById(id);
s.textContent=msg;
s.className=`status status-${type}`;
s.style.display='block';
if(type!=='error')setTimeout(()=>s.style.display='none',3000);
}

function clearInput(){
document.getElementById('htmlInput').value='';
document.getElementById('extractedGrid').innerHTML='';
document.getElementById('extractCount').textContent='0';
urls=[];
showStatus('status1','ì´ˆê¸°í™”','info');
}
</script>
</body>
</html>
