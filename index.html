<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì´ë¯¸ì§€ ë³‘í•©</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:sans-serif;background:#667eea;min-height:100vh;padding:20px}
.container{max-width:900px;margin:0 auto;background:#fff;border-radius:10px;padding:30px}
h1{color:#333;margin-bottom:5px;font-size:24px}
.subtitle{color:#666;margin-bottom:20px;font-size:13px}
.section{margin-bottom:20px;padding:20px;background:#f8f9fa;border-radius:10px}
.section-title{font-size:16px;font-weight:600;color:#333;margin-bottom:10px}
.step{display:inline-flex;width:24px;height:24px;background:#667eea;color:#fff;border-radius:50%;font-size:12px;font-weight:700;align-items:center;justify-content:center;margin-right:5px}
textarea{width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:13px;font-family:monospace;resize:vertical;background:#fff}
textarea:focus{outline:none;border-color:#667eea}
#htmlInput{height:180px}
#urlInput{height:220px}
.btn-group{margin-top:12px;display:flex;gap:8px}
button{padding:10px 20px;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer}
.btn-primary{background:#667eea;color:#fff;flex:1}
.btn-primary:hover{background:#5568d3}
.btn-secondary{background:#f0f0f0;color:#333}
.btn-secondary:hover{background:#e0e0e0}
.btn-extract{background:#28a745;color:#fff;flex:1}
.btn-extract:hover{background:#218838}
.btn-small{padding:6px 12px;font-size:12px}
#status{margin-top:15px;padding:12px;border-radius:8px;display:none}
.status-info{background:#e3f2fd;color:#1976d2}
.status-success{background:#e8f5e9;color:#388e3c}
.status-error{background:#ffebee;color:#d32f2f}
.status-warning{background:#fff3e0;color:#f57c00}
#preview{margin-top:20px;display:none}
#preview img{width:100%;border-radius:8px}
.progress-bar{width:100%;height:4px;background:#e0e0e0;border-radius:2px;overflow:hidden;margin-top:12px;display:none}
.progress-fill{height:100%;background:#667eea;width:0%;transition:width .3s}
.info{background:#fff;padding:10px;border-radius:6px;font-size:12px;color:#666;margin-top:8px;border-left:3px solid #667eea}
.arrow{text-align:center;font-size:20px;color:#667eea;margin:10px 0}
#imagePreviewContainer{display:none;margin-top:15px}
.preview-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;margin-top:12px}
.preview-item{position:relative;background:#fff;border:2px solid #e0e0e0;border-radius:8px;padding:8px;cursor:pointer}
.preview-item:hover{border-color:#667eea}
.preview-item.excluded{opacity:.4;border-color:#ccc}
.preview-item.excluded::after{content:'ì œì™¸';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.8);color:#fff;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:600}
.preview-item img{width:100%;height:100px;object-fit:contain;border-radius:4px}
.preview-item .url-text{font-size:10px;color:#666;margin-top:6px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.preview-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.preview-title{font-size:14px;font-weight:600;color:#333}
.preview-actions{display:flex;gap:6px}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ–¼ï¸ ì´ë¯¸ì§€ ë³‘í•©</h1>
<p class="subtitle">HTMLì—ì„œ ì´ë¯¸ì§€ ì¶”ì¶œ í›„ ì„¸ë¡œ ë³‘í•©</p>

<div class="section">
<div class="section-title"><span class="step">1</span>HTML ì…ë ¥</div>
<textarea id="htmlInput" placeholder="HTML ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"></textarea>
<div class="btn-group">
<button class="btn-extract" onclick="extractImages()">ğŸ” ì¶”ì¶œ</button>
<button class="btn-secondary" onclick="clearHtml()">ì´ˆê¸°í™”</button>
</div>
<div class="info">ğŸ’¡ img íƒœê·¸ì—ì„œ ìë™ ì¶”ì¶œ</div>

<div id="imagePreviewContainer">
<div class="preview-header">
<div class="preview-title">ğŸ“¸ ë¯¸ë¦¬ë³´ê¸°</div>
<div class="preview-actions">
<button class="btn-secondary btn-small" onclick="selectAllImages()">ì „ì²´ì„ íƒ</button>
<button class="btn-secondary btn-small" onclick="deselectAllImages()">ì „ì²´í•´ì œ</button>
</div>
</div>
<div class="preview-grid" id="previewGrid"></div>
<div class="info">â„¹ï¸ í´ë¦­í•˜ì—¬ ì œì™¸/í¬í•¨</div>
</div>
</div>

<div class="arrow">â¬‡ï¸</div>

<div class="section">
<div class="section-title"><span class="step">2</span>URL í™•ì¸</div>
<textarea id="urlInput" placeholder="ì¶”ì¶œëœ URL (ìˆ˜ì • ê°€ëŠ¥)"></textarea>
<div class="info">â„¹ï¸ ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥</div>
</div>

<div class="arrow">â¬‡ï¸</div>

<div class="section">
<div class="section-title"><span class="step">3</span>ë³‘í•©</div>
<div class="btn-group">
<button class="btn-primary" onclick="mergeImages()">ğŸ”„ ë³‘í•©</button>
<button class="btn-secondary" onclick="clearAll()">ì „ì²´ì´ˆê¸°í™”</button>
</div>
</div>

<div class="progress-bar" id="progressBar">
<div class="progress-fill" id="progressFill"></div>
</div>

<div id="status"></div>
<div id="preview"></div>
</div>

<script>
let urls=[],excluded=new Set();

// ë„¤ì´ë²„ ì¸ë„¤ì¼ URLì—ì„œ ì‹¤ì œ ì´ë¯¸ì§€ URL ì¶”ì¶œ
function decodeNaverUrl(url){
try{
// dthumb-phinf.pstatic.net í˜•íƒœì˜ URL ì²´í¬
if(url.includes('dthumb-phinf.pstatic.net')||url.includes('phinf.pstatic.net')){
// src= íŒŒë¼ë¯¸í„° ì°¾ê¸°
const srcMatch=url.match(/[?&]src=([^&]+)/);
if(srcMatch){
let innerUrl=decodeURIComponent(srcMatch[1]);
// ë”°ì˜´í‘œ ì œê±°
innerUrl=innerUrl.replace(/^["']|["']$/g,'');
// ì¬ê·€ì ìœ¼ë¡œ í•œ ë²ˆ ë” ì²´í¬ (ì¤‘ì²©ëœ ê²½ìš°)
return decodeNaverUrl(innerUrl);
}
}
return url;
}catch(e){
console.error('URL ë””ì½”ë”© ì˜¤ë¥˜:',e);
return url;
}
}

function extractImages(){
const html=document.getElementById('htmlInput').value.trim();
if(!html){showStatus('âš ï¸ HTMLì„ ì…ë ¥í•˜ì„¸ìš”','warning');return}
try{
const doc=new DOMParser().parseFromString(html,'text/html');
const imgs=doc.querySelectorAll('img');
urls=[];
imgs.forEach(img=>{
let src=img.getAttribute('src');
if(src&&src.trim()){
src=src.trim();
// ë„¤ì´ë²„ ì¸ë„¤ì¼ URL ì²˜ë¦¬
src=decodeNaverUrl(src);
urls.push(src);
}
});
if(!urls.length){showStatus('âš ï¸ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤','warning');return}
excluded.clear();
updateUrlInput();
const grid=document.getElementById('previewGrid');
grid.innerHTML='';
urls.forEach((url,i)=>{
const div=document.createElement('div');
div.className='preview-item';
div.dataset.index=i;
div.onclick=()=>toggleImage(i);
div.innerHTML=`<img src="${url}" alt="${i+1}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22><text x=%2250%%22 y=%2250%%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22>ì‹¤íŒ¨</text></svg>'"><div class="url-text" title="${url}">${url}</div>`;
grid.appendChild(div);
});
document.getElementById('imagePreviewContainer').style.display='block';
const decodedCount=urls.filter(u=>u.includes('shop-phinf.pstatic.net')||u.includes('shopping.pstatic.net')).length;
const msg=decodedCount>0?`âœ… ${urls.length}ê°œ ì¶”ì¶œ ì™„ë£Œ (ë„¤ì´ë²„ URL ${decodedCount}ê°œ ë””ì½”ë”©ë¨)`:`âœ… ${urls.length}ê°œ ì¶”ì¶œ ì™„ë£Œ`;
showStatus(msg,'success');
document.getElementById('imagePreviewContainer').scrollIntoView({behavior:'smooth',block:'center'});
}catch(e){showStatus(`âŒ ì˜¤ë¥˜: ${e.message}`,'error')}
}

function toggleImage(i){
const item=document.querySelector(`.preview-item[data-index="${i}"]`);
if(excluded.has(i)){excluded.delete(i);item.classList.remove('excluded')}
else{excluded.add(i);item.classList.add('excluded')}
updateUrlInput();
}

function selectAllImages(){
excluded.clear();
document.querySelectorAll('.preview-item').forEach(item=>item.classList.remove('excluded'));
updateUrlInput();
showStatus('âœ… ì „ì²´ ì„ íƒ','success');
}

function deselectAllImages(){
urls.forEach((_,i)=>excluded.add(i));
document.querySelectorAll('.preview-item').forEach(item=>item.classList.add('excluded'));
updateUrlInput();
showStatus('âŒ ì „ì²´ í•´ì œ','info');
}

function updateUrlInput(){
const selected=urls.filter((_,i)=>!excluded.has(i));
document.getElementById('urlInput').value=selected.join('\n');
}

async function mergeImages(){
const input=document.getElementById('urlInput').value.trim();
const preview=document.getElementById('preview');
const bar=document.getElementById('progressBar');
const fill=document.getElementById('progressFill');
preview.style.display='none';
preview.innerHTML='';
const list=input.split('\n').map(u=>u.trim()).filter(u=>u);
if(!list.length){showStatus('âš ï¸ URLì„ ì…ë ¥í•˜ì„¸ìš”','warning');return}

// ë„¤ì´ë²„ ì´ë¯¸ì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
const hasNaverImg=list.some(u=>u.includes('pstatic.net'));
if(hasNaverImg){
showStatus('â„¹ï¸ ë„¤ì´ë²„ ì´ë¯¸ì§€ ê°ì§€ - CORS í”„ë¡ì‹œ ì‚¬ìš© ì¤‘...','info');
}

showStatus(`${list.length}ê°œ ë‹¤ìš´ë¡œë“œ ì¤‘...`,'info');
bar.style.display='block';
try{
const imgs=[];
for(let i=0;i<list.length;i++){
let url=list[i];
// ë„¤ì´ë²„ ì´ë¯¸ì§€ëŠ” í”„ë¡ì‹œ ì‚¬ìš©
if(url.includes('pstatic.net')){
url='https://corsproxy.io/?'+encodeURIComponent(url);
}
const img=await loadImage(url);
imgs.push(img);
fill.style.width=((i+1)/list.length*100)+'%';
showStatus(`ë‹¤ìš´ë¡œë“œ ì¤‘... (${i+1}/${list.length})`,'info');
}
showStatus('ë³‘í•© ì¤‘...','info');
const canvas=document.createElement('canvas');
const ctx=canvas.getContext('2d');
const maxW=Math.max(...imgs.map(img=>img.width));
const totalH=imgs.reduce((sum,img)=>sum+img.height,0);
canvas.width=maxW;
canvas.height=totalH;
ctx.fillStyle='white';
ctx.fillRect(0,0,maxW,totalH);
let y=0;
for(const img of imgs){
const x=(maxW-img.width)/2;
ctx.drawImage(img,x,y);
y+=img.height;
}
const dataUrl=canvas.toDataURL('image/jpeg',.95);
preview.innerHTML=`<h3 style="margin-bottom:10px;color:#333">âœ… ì™„ë£Œ!</h3><p style="margin-bottom:10px;color:#666">í¬ê¸°: ${maxW} x ${totalH} px</p><img src="${dataUrl}"><button class="btn-primary" style="margin-top:15px;width:100%" onclick="downloadImage('${dataUrl}')">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>`;
preview.style.display='block';
showStatus(`âœ… ${imgs.length}ê°œ ë³‘í•© ì™„ë£Œ!`,'success');
bar.style.display='none';
preview.scrollIntoView({behavior:'smooth'});
}catch(e){
showStatus(`âŒ ì˜¤ë¥˜: ${e.message}. ì¼ë¶€ ì´ë¯¸ì§€ëŠ” CORS ì œí•œìœ¼ë¡œ ë³‘í•©ì´ ë¶ˆê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,'error');
bar.style.display='none';
}
}

function loadImage(url){
return new Promise((resolve,reject)=>{
const img=new Image();
img.crossOrigin='anonymous';
img.onload=()=>resolve(img);
img.onerror=()=>reject(new Error(`ë¡œë“œ ì‹¤íŒ¨: ${url.substring(0,50)}...`));
img.src=url;
});
}

function downloadImage(dataUrl){
const a=document.createElement('a');
a.download=`merged_${Date.now()}.jpg`;
a.href=dataUrl;
a.click();
}

function showStatus(msg,type){
const s=document.getElementById('status');
s.textContent=msg;
s.className=`status-${type}`;
s.style.display='block';
}

function clearHtml(){
document.getElementById('htmlInput').value='';
document.getElementById('imagePreviewContainer').style.display='none';
document.getElementById('previewGrid').innerHTML='';
urls=[];
excluded.clear();
showStatus('HTML ì´ˆê¸°í™”','info');
}

function clearAll(){
document.getElementById('htmlInput').value='';
document.getElementById('urlInput').value='';
document.getElementById('status').style.display='none';
document.getElementById('preview').style.display='none';
document.getElementById('progressBar').style.display='none';
document.getElementById('imagePreviewContainer').style.display='none';
document.getElementById('previewGrid').innerHTML='';
urls=[];
excluded.clear();
showStatus('ì „ì²´ ì´ˆê¸°í™”','info');
}
</script>
</body>
</html>
